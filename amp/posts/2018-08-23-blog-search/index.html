<!DOCTYPE html><html lang="ko" amp=""><head><style amp-boilerplate="">body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate="">body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript><style amp-custom="">
/* sc-component-id: sc-global-1126619604 */
@font-face{font-family:'Nanum Square';src:url('/fonts/nanum-square/fonts/NanumSquareL.eot');src:url('/fonts/nanum-square/fonts/NanumSquareL.eot?#iefix') format('embedded-opentype'), url('/fonts/nanum-square/fonts/NanumSquareL.woff') format('woff'), url('/fonts/nanum-square/fonts/NanumSquareL.ttf') format('truetype'), url('/fonts/nanum-square/fonts/NanumSquareOTFLight.svg#017f9c78318bcde3d1dc4451e8eaca0a') format('svg');font-style:normal;font-weight:300;} @font-face{font-family:'Nanum Square';src:url('/fonts/nanum-square/fonts/NanumSquareR.eot');src:url('/fonts/nanum-square/fonts/NanumSquareR.eot?#iefix') format('embedded-opentype'), url('/fonts/nanum-square/fonts/NanumSquareR.woff') format('woff'), url('/fonts/nanum-square/fonts/NanumSquareR.ttf') format('truetype'), url('/fonts/nanum-square/fonts/NanumSquareOTFR.svg#9e23ceb0c858ca37642ba540402577eb') format('svg');font-style:normal;font-weight:400;} @font-face{font-family:'Nanum Square';src:url('/fonts/nanum-square/fonts/NanumSquareB.eot');src:url('/fonts/nanum-square/fonts/NanumSquareB.eot?#iefix') format('embedded-opentype'), url('/fonts/nanum-square/fonts/NanumSquareB.woff') format('woff'), url('/fonts/nanum-square/fonts/NanumSquareB.ttf') format('truetype'), url('/fonts/nanum-square/fonts/NanumSquareOTFB.svg#a41a1fda1fdf3dafd3394867a156b1cf') format('svg');font-style:normal;font-weight:700;} @font-face{font-family:'Nanum Square';src:url('/fonts/nanum-square/fonts/NanumSquareEB.eot');src:url('/fonts/nanum-square/fonts/NanumSquareEB.eot?#iefix') format('embedded-opentype'), url('/fonts/nanum-square/fonts/NanumSquareEB.woff') format('woff'), url('/fonts/nanum-square/fonts/NanumSquareEB.ttf') format('truetype'), url('/fonts/nanum-square/fonts/NanumSquareOTFExtraBold.svg#090d6763bc81b49309446d23fbd10e87') format('svg');font-style:normal;font-weight:900;} @font-face{font-family:Menlo Regular;src:url("/fonts/menlo-regular.eot"),url("/fonts/menlo-regular.woff2"),url("/fonts/menlo-regular.woff"),url("/fonts/menlo-regular.ttf"),url("/fonts/menlo-regular.svg");} .iframe-video-wrapper{position:relative;display:block;padding-bottom:56.25%;margin:3.2rem 0;} .iframe-video{position:absolute;top:0;left:0;width:100%;height:100%;}
/* sc-component-id: sc-global-1580613031 */
code,code[class*='language-'],pre[class*='language-']{color:#333;text-align:left;white-space:pre;word-spacing:normal;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;font-family:Menlo,'Liberation Mono',Consolas,Courier,monospace;line-height:1.4;direction:ltr;cursor:text;border:none;} pre[class*='language-']{overflow:auto;margin:1em 0;padding:1.2em;border-radius:3px;font-size:85%;} pre code{background:none;} p code,li code,table code{margin:0;border-radius:3px;padding:0.2em 0;font-size:85%;} p code:before,p code:after,li code:before,li code:after,table code:before,table code:after{-webkit-letter-spacing:-0.2em;-moz-letter-spacing:-0.2em;-ms-letter-spacing:-0.2em;letter-spacing:-0.2em;content:'\0a0';} code,:not(pre) > code[class*='language-'],pre[class*='language-']{background:rgba(0,0,0,0.04);} :not(pre) > code[class*='language-']{padding:0.1em;border-radius:0.3em;} .token.comment,.token.prolog,.token.doctype,.token.cdata{color:#969896;} .token.punctuation,.token.string,.token.atrule,.token.attr-value{color:#183691;} .token.property,.token.tag{color:#63a35c;} .token.boolean,.token.number{color:#0086b3;} .token.selector,.token.attr-name,.token.attr-value .punctuation:first-child,.token.keyword,.token.regex,.token.important{color:#795da3;} .token.operator,.token.entity,.token.url,.language-css .token.string{color:#a71d5d;} .token.entity{cursor:help;} .namespace{opacity:0.7;}
/* sc-component-id: sc-bdVaJa */
.jnbfRs{position:relative;min-height:100vh;padding-top:3.2rem;padding-bottom:4.8rem;}
/* sc-component-id: sc-htpNat */
.ibTlJH{width:100%;padding:0 1.2rem;margin-left:auto;margin-right:auto;margin-top:3.2rem;} @media (min-width:1060px){.ibTlJH{width:1020px;padding:0 1.6rem;}} @media (min-width:750px){.ibTlJH{width:740px;}}
/* sc-component-id: sc-gzVnrw */
.yBqkO{position:relative;height:1.8rem;}
/* sc-component-id: sc-htoDjs */
.ffnQHj{height:100%;border:none;outline:none;padding:0 1rem 0 1.8rem;background-color:transparent;border-radius:6px;color:white;font-size:0.9rem;width:30px;} .ffnQHj:focus{width:130px;background-color:rgba(0,0,0,0.1);} @media (max-width:321px){.ffnQHj:focus{width:100px;}} @media (min-width:550px){.ffnQHj{width:180px;}.ffnQHj:focus{width:180px;}}
/* sc-component-id: sc-dnqmqq */
.ilmozt{position:absolute;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);left:0.4em;color:#fff;}
/* sc-component-id: sc-iwsKbI */
.kfPVeK{position:fixed;z-index:1;top:0;left:0;width:100%;background:linear-gradient(to right,#4568dc,#b06ab3);border-bottom:1px solid #ebebeb;} .kfPVeK::after{clear:both;content:"";display:table;}
/* sc-component-id: sc-gZMcBi */
.enSemP{width:100%;padding:0 1.2rem;margin-left:auto;margin-right:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;} @media (min-width:1060px){.enSemP{width:1020px;padding:0 1.6rem;}}
/* sc-component-id: sc-gqjmRU */
.fQsfTz{margin-right:auto;color:#fff;font-weight:400;font-size:1.2rem;font-family:'Roboto',sans-serif;line-height:3.2rem;-webkit-letter-spacing:-1px;-moz-letter-spacing:-1px;-ms-letter-spacing:-1px;letter-spacing:-1px;font-weight:400;}
/* sc-component-id: sc-VigVT */
.iDHBWR{margin-left:auto;}
/* sc-component-id: sc-jTzLTM */
.fFLaDK{margin:0 0 0 1rem;list-style:none;padding-left:0;}
/* sc-component-id: sc-fjdhpX */
.gaVplg{float:left;line-height:3.2rem;margin-bottom:0;font-family:'Roboto',sans-serif;font-size:1rem;font-weight:400;color:#fff;} .gaVplg:not(:first-child){margin-left:0.5rem;}
/* sc-component-id: sc-jzJRlG */
.gIzvqs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:absolute;bottom:0;width:100%;height:4.8rem;padding:0.5rem 0;background-color:#fff;border-top:1px solid #ebebeb;font-family:'Roboto',sans-serif;line-height:1.4;text-align:center;}
/* sc-component-id: sc-cSHVUG */
.hjGWNs{width:100%;padding:0 1.2rem;margin-left:auto;margin-right:auto;font-family:'Roboto';font-weight:400;font-size:0.7rem;} @media (min-width:1060px){.hjGWNs{width:1020px;padding:0 1.6rem;}} @media (min-width:550px){.hjGWNs{font-size:0.75rem;}}
/* sc-component-id: sc-chPdSV */
.rzYpB{color:hsla(291,0%,18%,0.95);-webkit-text-decoration:underline;text-decoration:underline;}
/* sc-component-id: sc-kgoBCf */
.fRgFwc{text-align:center;font-size:0.75rem;margin-top:0.5rem;} @media (min-width:550px){.fRgFwc{font-size:0.85rem;}} .fRgFwc > *{margin-left:0.5em;} .fRgFwc i{color:hsla(291,0%,18%,0.95);}
/* sc-component-id: sc-kkGfuU */
.izfdmx{margin-left:-0.3rem;} .izfdmx::after{clear:both;content:"";display:table;}
/* sc-component-id: sc-iAyFgw */
.dWqGOM{font-family:'Roboto';font-size:0.8rem;font-weight:400;display:block;float:left;padding:0.25em 0.625em;margin-bottom:0.35em;margin-left:0.35em;line-height:1.6rem;color:rgba(0,0,0,0.6);background-color:rgba(0,0,0,0.04);border-radius:3px;} .dWqGOM:hover{background-color:rgba(0,0,0,0.1);}
/* sc-component-id: sc-hSdWYo */
.gsxEqL{text-align:left;font-weight:700;margin-bottom:0.5rem;}
/* sc-component-id: sc-cvbbAY */
.kaWfho{font-size:0.9rem;} .kaWfho::after{clear:both;content:"";display:table;}
/* sc-component-id: sc-jWBwVP */
.fFwzBl{margin-top:0.8rem;}
/* sc-component-id: sc-jAaTju */
.bwsTGS{margin-top:3.2rem;margin-bottom:3.2rem;}
/* sc-component-id: sc-jDwBTQ */
.jmhhxf{border:none;display:block;padding:0;margin:0 0.75rem;-webkit-transition:color 0.2s linear;transition:color 0.2s linear;color:#88939d;background:none;} .jmhhxf:hover{color:#725ec1;cursor:pointer;}
/* sc-component-id: sc-gPEVay */
.iplCgW{border:none;display:block;padding:0;margin:0 0.75rem;-webkit-transition:color 0.2s linear;transition:color 0.2s linear;color:#88939d;background:none;} .iplCgW:hover{color:#725ec1;cursor:pointer;}
/* sc-component-id: sc-iRbamj */
.ipnZXT{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin:2.5rem 0;}
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  $[object Object]html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:87.5%/1.6 'Nanum Square','Spectral',-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(291, 0%, 18%,0.95);font-family:'Nanum Square','Spectral',-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}h1{margin-left:0;margin-right:0;margin-top:7.2rem;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:2.4rem;color:hsla(291, 0%, 18%,1);font-family:'Nanum Square','Roboto','Spectral',-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:2.4rem;line-height:3.2rem;}h2{margin-left:0;margin-right:0;margin-top:5.6rem;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:2.4rem;color:hsla(291, 0%, 18%,1);font-family:'Nanum Square','Roboto','Spectral',-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1.6875rem;line-height:2.4rem;}h3{margin-left:0;margin-right:0;margin-top:4rem;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:2.4rem;color:hsla(291, 0%, 18%,1);font-family:'Nanum Square','Roboto','Spectral',-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1.375rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:3.2rem;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:hsla(291, 0%, 18%,1);font-family:'Nanum Square','Roboto','Spectral',-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1.2rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:3.2rem;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:hsla(291, 0%, 18%,1);font-family:'Nanum Square','Roboto','Spectral',-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:3.2rem;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.6rem;color:hsla(291, 0%, 18%,1);font-family:'Nanum Square','Roboto','Spectral',-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}ul{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.6rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;margin:2.4rem 0;line-height:1.84rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:0.85rem;line-height:1.6rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;font-size:1rem;line-height:1.6rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}blockquote{margin-left:-1.2rem;margin-right:-1.2rem;margin-top:3.2rem;padding-bottom:0;padding-left:1.6rem;padding-right:1.2rem;padding-top:0;margin-bottom:3.2rem;border-left:3px solid hsla(291, 0%, 18%,0.6);color:hsla(291, 0%, 18%,0.6);font-style:italic;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.2rem - 1px);background:hsla(291, 0%, 18%,0.1);border:none;height:1px;margin:4rem auto;width:50%;color:hsla(291, 0%, 18%,1);background-image:linear-gradient(90deg,rgba(34,34,34,.2),rgba(34,34,34,.75),rgba(34,34,34,.2));}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.2rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.2rem / 2);line-height:1.84rem;}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}li > ul{margin-left:1.6rem;margin-bottom:calc(1.2rem / 2);margin-top:calc(1.2rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.2rem / 2);}code{font-size:0.85rem;line-height:1.6rem;}kbd{font-size:0.85rem;line-height:1.6rem;}samp{font-size:0.85rem;line-height:1.6rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.06667rem;padding-right:1.06667rem;padding-top:0.8rem;padding-bottom:calc(0.8rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{border-color:#2e2e2e;color:#2e2e2e;text-decoration:none;}@media (min-width: 550px){html{font-size:109.375%;}}p > img{margin-bottom:1.6rem;}p > img + em{font-size:0.85em;line-height:1.4;display:block;text-align:right;margin-bottom:3.2rem;color:hsla(291, 0%, 18%,0.5);}.gatsby-resp-image-link{box-shadow:none;margin-top:3.2rem;margin-bottom:3.2rem;}.gatsby-resp-image-link:hover{background:none;box-shadow:none;}@media only screen and (min-width:38rem){.gatsby-resp-image-link{border-radius:.15rem;overflow:hidden;}}.post > .gatsby-highlight, .gatsby-resp-iframe-wrapper, .gatsby-resp-image-link{margin-left:-1.2rem;margin-right:-1.2rem;}.post .gatsby-resp-image-link + em{font-size:0.8em;line-height:1.4;display:block;margin-top:-1.6rem;margin-bottom:3.2rem;color:hsla(291, 0%, 18%,0.5);text-align:center;font-style:normal;}.post .gatsby-resp-image-link + em > a{color:hsla(291, 0%, 18%,0.5);background-image:none ;}tt, code{font-family:Menlo,"Space Mono",Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Courier,monospace;font-variant:none;-webkit-font-feature-settings:"clig" 0, "calt" 0;font-feature-settings:"clig" 0, "calt" 0;padding-top:0.1em;padding-bottom:0.1em;background-color:#f8f8f8;border-radius:2px;font-size:0.85em;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:"";}.gatsby-highlight{background-color:rgba(0,0,0, 0.04);border-radius:.15rem;margin-top:0;margin-bottom:1.2rem;padding:1.2rem;overflow:auto;}.gatsby-highlight pre[class*='language-']{background-color:transparent;border-radius:0;margin:0;padding:0;overflow:initial;float:left;min-width:100%;text-shadow:none;}.gatsby-highlight-code-line{background:#fff2cc;display:block;margin-right:-1.2rem;margin-left:-1.2rem;padding-right:1.2rem;padding-left:0.8rem;border-left:0.4rem solid #ffd9b3;}.post a:not(.gatsby-resp-image-link):not(.anchor), .link-underline{position:relative;background-image:linear-gradient(#2e2e2e,#2e2e2e);text-shadow:0.03em 0 #fff, -0.03em 0 #fff, 0 0.03em #fff, 0 -0.03em #fff, 0.06em 0 #fff, -0.06em 0 #fff, 0.09em 0 #fff, -0.09em 0 #fff, 0.12em 0 #fff, -0.12em 0 #fff, 0.15em 0 #fff, -0.15em 0 #fff;transition:all 250ms cubic-bezier(0.4, 0, 0.2, 1);background-position:0 98%;background-repeat:repeat-x;background-size:1px 1px;}.post a:not(.gatsby-resp-image-link):not(.anchor):hover, .link-underline:hover{color:#4568dc;background-image:linear-gradient(#4568dc,#4568dc);}.post a.anchor{text-shadow:0 ;background-image:0 ;}.post a[href*='//']:after{content:" " url("data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20class='i-external'%20viewBox='0%200%2032%2032'%20width='14'%20height='14'%20fill='none'%20stroke='%232e2e2e'%20stroke-linecap='round'%20stroke-linejoin='round'%20stroke-width='9.38%'%3E%3Cpath%20d='M14%209%20L3%209%203%2029%2023%2029%2023%2018%20M18%204%20L28%204%2028%2014%20M28%204%20L14%2018'/%3E%3C/svg%3E");padding-right:0.2rem;}.post a[href*='//']:hover:after{content:" " url("data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20class='i-external'%20viewBox='0%200%2032%2032'%20width='14'%20height='14'%20fill='none'%20stroke='%234568dc'%20stroke-linecap='round'%20stroke-linejoin='round'%20stroke-width='9.38%'%3E%3Cpath%20d='M14%209%20L3%209%203%2029%2023%2029%2023%2018%20M18%204%20L28%204%2028%2014%20M28%204%20L14%2018'/%3E%3C/svg%3E");}@media (min-width: 1060px){html{font-size:118.75%;}}</style><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="icon" type="image/x-icon" href="/favicon.ico"><title data-react-helmet="true"></title><link rel="preload" href="/component---src-templates-post-page-js-fea05e6bacfc6cbe4df9.js"><link rel="preload" href="/path---posts-2018-08-23-blog-search-95cca2ab6b621569ccf3.js"><link rel="preload" href="/app-e306834a1f2e2bb831a6.js"><link rel="preload" href="/commons-50619afde6b6caaea7b7.js"><link rel="sitemap" type="application/xml" href="/sitemap.xml"><link rel="manifest" href="/manifest.webmanifest"><meta name="theme-color" content="#4568dc"><link rel="alternate" type="application/rss+xml" href="/rss.xml"><title data-react-helmet="true">블로그 검색 기능 개발 과정</title><meta data-react-helmet="true" name="author" content="rhostem"><meta data-react-helmet="true" name="keywords" content="검색,Node.js,Web Worker,Service Worker,UMD"><meta data-react-helmet="true" name="description" content="블로그 클라이언트 사이드 검색 기능 개발 과정. 포스트 텍스트에서 역색인을 구성하고 Service Worker, Web Worker, UMD 등의 기술을 사용했다."><meta data-react-helmet="true" itemprop="name" content="블로그 검색 기능 개발 과정"><meta data-react-helmet="true" itemprop="description" content="블로그 클라이언트 사이드 검색 기능 개발 과정. 포스트 텍스트에서 역색인을 구성하고 Service Worker, Web Worker, UMD 등의 기술을 사용했다."><meta data-react-helmet="true" itemprop="image" content="https://rhostem.github.ioundefined"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="og:url" content="https://rhostem.github.io/posts/2018-08-23-blog-search/"><meta data-react-helmet="true" property="og:title" content="블로그 검색 기능 개발 과정"><meta data-react-helmet="true" property="og:description" content="블로그 클라이언트 사이드 검색 기능 개발 과정. 포스트 텍스트에서 역색인을 구성하고 Service Worker, Web Worker, UMD 등의 기술을 사용했다."><meta data-react-helmet="true" property="og:image" content="https://rhostem.github.ioundefined"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="twitter:title" content="블로그 검색 기능 개발 과정"><meta data-react-helmet="true" name="twitter:description" content="블로그 클라이언트 사이드 검색 기능 개발 과정. 포스트 텍스트에서 역색인을 구성하고 Service Worker, Web Worker, UMD 등의 기술을 사용했다."><meta data-react-helmet="true" name="twitter:image" content="https://rhostem.github.ioundefined"><noscript data-react-helmet="true">
            Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
          </noscript><link rel="canonical" href="/posts/2018-08-23-blog-search/"><script async src="https://cdn.ampproject.org/v0.js"></script><script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script></head><body><div id="___gatsby"><div data-reactroot="" data-reactid="1" data-react-checksum="370438761"><main class="sc-bdVaJa jnbfRs" data-reactid="2"><!-- react-empty: 3 --><nav class="sc-iwsKbI kfPVeK" data-reactid="4"><div class="sc-gZMcBi enSemP" data-reactid="5"><a href="/" data-reactid="6"><div class="sc-gqjmRU fQsfTz" data-reactid="7">rhostem.github.io</div></a><div class="sc-VigVT iDHBWR" data-reactid="8"><div class="sc-gzVnrw yBqkO" data-reactid="9"><i class="fa fa-search sc-dnqmqq ilmozt" data-reactid="10"></i><input type="text" class="sc-htoDjs ffnQHj" id="searchInput" placeholder="포스트 검색" value="" data-reactid="11"><!-- react-empty: 12 --></div></div><ul class="sc-jTzLTM fFLaDK" data-reactid="13"><a class="sc-fjdhpX gaVplg" href="/archive" data-reactid="14">Archive</a></ul></div></nav><div class="sc-htpNat ibTlJH" data-reactid="15"><header data-reactid="16"><h1 class="sc-hSdWYo gsxEqL" data-reactid="17">블로그 검색 기능 개발 과정</h1><!-- react-text: 18 --><!-- /react-text --><div class="sc-cvbbAY kaWfho" data-reactid="19"><!-- react-text: 20 -->2018-08-23<!-- /react-text --><!-- react-text: 21 --> · 읽기 <!-- /react-text --><!-- react-text: 22 -->7<!-- /react-text --><!-- react-text: 23 -->분<!-- /react-text --></div><div class="sc-jWBwVP fFwzBl" data-reactid="24"><div class="sc-kkGfuU izfdmx" data-reactid="25"><span class="sc-iAyFgw dWqGOM" data-reactid="26"><a href="/tag/검색" data-reactid="27">검색</a></span><span class="sc-iAyFgw dWqGOM" data-reactid="28"><a href="/tag/node.js" data-reactid="29">Node.js</a></span><span class="sc-iAyFgw dWqGOM" data-reactid="30"><a href="/tag/web_worker" data-reactid="31">Web Worker</a></span><span class="sc-iAyFgw dWqGOM" data-reactid="32"><a href="/tag/service_worker" data-reactid="33">Service Worker</a></span><span class="sc-iAyFgw dWqGOM" data-reactid="34"><a href="/tag/umd" data-reactid="35">UMD</a></span></div></div></header></div><div class="sc-htpNat ibTlJH" data-reactid="36"><article class="post sc-jAaTju bwsTGS" data-reactid="37"><p>블로그를 만든 지 거의 2년이 다 되어가고 작성한 포스트도 어느덧 20개를 넘었다. 콘텐츠가 쌓이니 자연스럽게 ‘검색’ 기능을 붙이고 싶은 욕심이 들었다. Gatsby를 사용해서 만든 블로그라서 플러그인을 검색해 보니 역시 검색 기능을 구현한 것이 있었다. 자바스크립트 기반의 검색 엔진인 <a href="http://elasticlunr.com/">Elasticlunr.js</a>를 사용한 플러그인이었는데, 테스트해 보니 안타깝게도 한글 문장은 인덱싱되지 않았다. 그래서 공부도 할 겸 직접 구현하기로 했다.</p>
<h2 id="자체-검색-엔진-구현"><a href="#%EC%9E%90%EC%B2%B4-%EA%B2%80%EC%83%89-%EC%97%94%EC%A7%84-%EA%B5%AC%ED%98%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>자체 검색 엔진 구현</h2>
<p>우선 검색 기능에 대한 요구 사항을 정리해 보았다.</p>
<ul>
<li><a href="https://pages.github.com/">Github pages</a>에 호스팅 된 정적인(static) 사이트라서 검색은 브라우저에서 진행되어야 한다.</li>
<li>클라이언트 사이드 검색이므로 인덱싱 파일은 크기가 가능한 한 작아야 한다.</li>
<li>영어 및 한글도 검색 가능해야 한다.</li>
<li>검색 결과에는 매칭된 포스트 제목과 태그를 표시해야 한다.</li>
</ul>
<h2 id="nodejs에서-검색을-위한-콘텐츠-인덱싱-진행"><a href="#nodejs%EC%97%90%EC%84%9C-%EA%B2%80%EC%83%89%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%BD%98%ED%85%90%EC%B8%A0-%EC%9D%B8%EB%8D%B1%EC%8B%B1-%EC%A7%84%ED%96%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>node.js에서 검색을 위한 콘텐츠 인덱싱 진행</h2>
<p>콘텐츠를 단어를 추출한 후 단어와 그 단어를 포함한 페이지를 매칭시킨 <a href="https://ko.wikipedia.org/wiki/%EC%97%AD%EC%83%89%EC%9D%B8">역색인</a>을 구성하는 방법을 사용했다. 처음에는 문장 검색을 위해 글자를 하나하나 분리하고 인접한 단어 정보를 저장해서 검색 결과와 함께 문장을 다시 구성할 수 있도록 하려고 했었다. 그런데 그 과정에서 인덱싱 파일의 크기가 너무 커져 버렸고 효율도 좋지 않았다. 결국, 단어 단위의 역 인덱스로 내가 할 수 있는 구현을 하자는 쪽으로 방향을 틀었다.</p>
<p>인덱싱 데이터 구성은 node.js 환경에서 아래의 과정을 통해 진행된다.</p>
<ol>
<li>콘텐츠가 포함된 모든 마크다운(md) 파일을 가져온다.</li>
<li>마크다운에서 YAML 형식으로 작성된 front matter 영역과 본문을 분리한다.</li>
<li><a href="https://github.com/remarkjs/remark">remark</a> 라이브러리로 콘텐츠 본문을 텍스트로 변환한다.</li>
<li>본문 텍스트에서 단어를 분리하고 포스트 경로로 매핑하는 단어 맵을 만든다.</li>
<li>front matter에서는 제목, 태그 정보를 추출한다.</li>
<li>검색에 필요한 데이터를 JSON 파일로 저장한다.</li>
</ol>
<p>인덱싱 파일을 생성하면 아래과 같은 형태가 된다.</p>
<div class="gatsby-highlight">
      <pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"wordList"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"[번역]"</span><span class="token punctuation">,</span>
    <span class="token string">"자바스크립트"</span><span class="token punctuation">,</span>
    <span class="token string">"피로감을"</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"wordMap"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@_[번역]"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"r"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"@_자바스크립트"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"r"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"@_피로감을"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"r"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"routeMap"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"1"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"route"</span><span class="token operator">:</span> <span class="token string">"/posts/2016-12-19-A-Study-Plan-To-Cure-JavaScript-Fatigue"</span><span class="token punctuation">,</span>
      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"[번역] 자바스크립트 피로감을 줄여주기 위한 학습 계획"</span><span class="token punctuation">,</span>
      <span class="token property">"tags"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"번역"</span><span class="token punctuation">,</span> <span class="token string">"JavaScript"</span><span class="token punctuation">,</span> <span class="token string">"React"</span><span class="token punctuation">,</span> <span class="token string">"Redux"</span><span class="token punctuation">,</span> <span class="token string">"Gatsby"</span><span class="token punctuation">,</span> <span class="token string">"ES"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"tagList"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"번역"</span><span class="token punctuation">,</span>
    <span class="token string">"JavaScript"</span><span class="token punctuation">,</span>
    <span class="token string">"React"</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>사용자의 검색어를 입력받으면 <code class="language-text">wordList</code>와 <code class="language-text">tagList</code>에서 매칭되는 단어를 찾은 후 <code class="language-text">routeMap</code>에 저장된 정보를 활용해서 결과를 보여주는 방식이다. 실제 검색 로직에서는 결과 정렬을 위한 랭킹 점수 부여 등의 과정이 추가된다.</p>
<p>콘텐츠의 총글자 수가 약 35만 자인 상태에서 인덱싱 파일을 생성하니 그 크기가 350KB 정도로 브라우저에서 충분히 감당할 수 있을 정도였다. gzip으로 인코딩하면 100KB까지 줄어든다. 하지만 그 크기는 점점 커질 테니, 인덱싱 데이터를 서비스 워커를 사용해서 미리 불러오도록 했다.</p>
<h2 id="서비스-워커service-worker를-사용한-검색-데이터-캐싱"><a href="#%EC%84%9C%EB%B9%84%EC%8A%A4-%EC%9B%8C%EC%BB%A4service-worker%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%BA%90%EC%8B%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>서비스 워커(Service Worker)를 사용한 검색 데이터 캐싱</h2>
<p><a href="https://developer.mozilla.org/ko/docs/Web/API/Service_Worker_API">서비스 워커</a>는 브라우저의 백그라운드에서 동작하면서 웹앱과 브라우저, 네트워크 사이의 프락시 역할을 한다.
원격 데이터를 호출하는 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">fetch</a> 이벤트를 감지해서 특정 네트워크 요청에 대한 응답을 캐싱하는 등의 작업이 가능하다. 그리고 웹앱에 필요한 리소스를 내려받아서 <a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage">CacheStorage</a>에 저장해서 재방문 시 빠르게 가져올 수 있도록 한다. (서비스 워커를 사용하면 <a href="https://wicg.github.io/BackgroundSync/spec/#sync-manager-interface">백그라운드 동기화</a>도 가능하지만 아직은 크롬 브라우저에서만 가능한 기술이다) 이를 바탕으로 네트워크가 불안하거나 오프라인인 상태에서도 앱이 구동할 수 있도록 할 수 있다. 네트워크 요청을 하지 않는 앱이라면 네이티브 앱과 다를 바가 없게 되는 것이다.</p>
<p>검색 기능을 구현하면서 서비스 워커를 사용해서 덩치가 큰 인덱싱 파일을 CacheStorage에 저장했다. 이런 기능을 간편히 사용하기 위한 라이브러리에는 <a href="https://github.com/GoogleChromeLabs/sw-precache">sw-precache</a>가 있다. Gatsby에는 이를 바탕으로 한 플러그인이 이미 존재하고 있으며, 나도 사용하고 있었다. <a href="https://www.gatsbyjs.org/packages/gatsby-plugin-offline/?=offline">gatsby-plugin-offline</a>이 그것인데, 기본 옵션만 사용해도 웹사이트 데이터를 잘 캐싱해준다. 이 플러그인의 추가 옵션을 살짝 수정해서 덩치가 큰 인덱싱 파일도 저장하도록 했다.</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> rootDir <span class="token operator">=</span> <span class="token string">'public'</span>

<span class="token operator">...</span>

<span class="token punctuation">{</span>
  resolve<span class="token punctuation">:</span> <span class="token string">'gatsby-plugin-offline'</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    staticFileGlobs<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rootDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/search/*.json`</span></span><span class="token punctuation">,</span> <span class="token comment">// 검색 인덱싱 파일 추가</span>
      <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rootDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/**/*.{woff2}`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rootDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/commons-*js`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rootDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/app-*js`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rootDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.html`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rootDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/manifest.json`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rootDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/manifest.webmanifest`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rootDir<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/offline-plugin-app-shell-fallback/index.html`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>

<span class="token operator">...</span></code></pre>
      </div>
<p>
  <a class="gatsby-resp-image-link" href="/static/precache_1-caa574bc279d3314a55c820cc9c35c8d-2c9da.png" target="_blank" rel="noopener">
  
  <span class="gatsby-resp-image-wrapper">
    <span class="gatsby-resp-image-background-image">
      <amp-img class="gatsby-resp-image-image" alt="precache_1.png" title="" src="/static/precache_1-caa574bc279d3314a55c820cc9c35c8d-2c9da.png" srcset="/static/precache_1-caa574bc279d3314a55c820cc9c35c8d-b8e76.png 265w,
/static/precache_1-caa574bc279d3314a55c820cc9c35c8d-2c9da.png 527w" sizes="(max-width: 527px) 100vw, 527px" width="525" height="105" layout="responsive"></amp-img>
    </span>
  </span>
  
  </a>
    
<em>최초 방문</em></p>
<p>
  <a class="gatsby-resp-image-link" href="/static/precache_2-ab9569c1cfcf2285ed7b5dbe685da272-2c9da.png" target="_blank" rel="noopener">
  
  <span class="gatsby-resp-image-wrapper">
    <span class="gatsby-resp-image-background-image">
      <amp-img class="gatsby-resp-image-image" alt="precache_2.png" title="" src="/static/precache_2-ab9569c1cfcf2285ed7b5dbe685da272-2c9da.png" srcset="/static/precache_2-ab9569c1cfcf2285ed7b5dbe685da272-b8e76.png 265w,
/static/precache_2-ab9569c1cfcf2285ed7b5dbe685da272-2c9da.png 527w" sizes="(max-width: 527px) 100vw, 527px" width="525" height="100" layout="responsive"></amp-img>
    </span>
  </span>
  
  </a>
    
<em>재방문</em></p>
<p>스크린 샷을 살펴보면 <code class="language-text">searchIndex.json</code> 파일을 가져오는 데 걸리는 시간이 처음에는 118ms지만 재방문했을 때는 서비스 워커를 통해 10ms가 걸렸다. 1/10 정도로 많이 줄어들었다는 사실을 확인할 수 있다.</p>
<h2 id="웹-워커web-worker를-사용한-검색"><a href="#%EC%9B%B9-%EC%9B%8C%EC%BB%A4web-worker%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%9C-%EA%B2%80%EC%83%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>웹 워커(Web Worker)를 사용한 검색</h2>
<p>자바스크립트는 싱글 스레드라고 알고 있는 사람들이 많지만, 웹 워커(<a href="https://developer.mozilla.org/ko/docs/Web/API/Web_Workers_API">Web Workers</a>)를 사용하면 멀티 스레드 프로그래밍이 가능하다. 그리고 서비스 워커보다는 브라우저 지원 폭이 넓어서 인터넷 익스플로러 9를 반드시 지원해야 하는 웹사이트가 아니라면 사용해도 된다. 웹 워커를 사용하면 좋은 사례에는 다음과 같은 것들이 있다.</p>
<ul>
<li>Ray tracing(이미지 렌더링 기술)</li>
<li>암호화</li>
<li>데이터 prefetching</li>
<li>Progressive Web App</li>
<li>문법 검사</li>
<li>타이머</li>
</ul>
<p>상대적으로 큰 데이터를 처리해야 해서 검색 로직 구현에도 웹 워커를 사용하기로 했다. 하지만 웹 워커와 메인 스레드 사이의 통신을 위해서는 <code class="language-text">postMessage</code>를 사용해서 데이터를 보내고, <code class="language-text">onmessage</code> 이벤트 핸들러에서 데이터를 받아서 처리해야 한다. 워커에 의미 있는 이름을 가진 메소드를 추가해서 보다 가독성 있는 방법으로 통신할 방법은 아직은 없다. 이를 개선하기 위한 <a href="https://github.com/GoogleChromeLabs/comlink">comlink</a>라는 라이브러리가 있긴 하다. 하지만 나는 redux에서 하는 것처럼 정형화된 데이터를 주고받는 방식으로 구현했다.</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token comment">// 메인 스레드 소스 코드</span>
<span class="token keyword">let</span> searchWorker
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>Worker <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>searchWorker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 웹 워커 등록</span>
  searchWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'/js/search-worker.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> searchService <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 검색</span>
  find<span class="token punctuation">:</span> <span class="token punctuation">(</span>searchInput <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    searchWorker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      action<span class="token punctuation">:</span> <span class="token string">'SEARCH_REQUEST'</span><span class="token punctuation">,</span>
      payload<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        searchInput<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token comment">// 웹 워커 소스 코드</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> action <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>action
  <span class="token keyword">var</span> payload <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>payload

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'SEARCH_REQUEST'</span><span class="token punctuation">:</span>
      <span class="token function">search</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>searchInput<span class="token punctuation">)</span>
      <span class="token keyword">break</span>

    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">break</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">search</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span></code></pre>
      </div>
<p>이런 식으로 스레드 간에 데이터를 주고받을 수 있다. 위의 코드에서는 메인 스레드에서 메시지를 보내고, 웹 워커에서 메시지를 받는 과정이 표현되어 있지만 당연히 반대로도 가능하다.</p>
<p>웹 워커를 사용해서 350KB 크기의 데이터를 검색하는 데 보통 0.15~0.2초가 걸렸다.</p>
<h2 id="nodejs-브라우저-웹-워커에서-함께-사용할-모듈-작성"><a href="#nodejs-%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EC%9B%B9-%EC%9B%8C%EC%BB%A4%EC%97%90%EC%84%9C-%ED%95%A8%EA%BB%98-%EC%82%AC%EC%9A%A9%ED%95%A0-%EB%AA%A8%EB%93%88-%EC%9E%91%EC%84%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>Node.js, 브라우저, 웹 워커에서 함께 사용할 모듈 작성</h2>
<p>검색 기능을 구현하는 과정에서 node.js, 브라우저, 웹 워커에서 공통으로 사용해야 하는 로직이 발견되었다. 인덱싱과 검색 과정에서 문장과 단어의 불필요한 문자를 제거하는 기능이 대표적이다. 그리고 웹 워커를 사용하니 스레드 간의 메시지를 구분할 때 사용하는 enum 역할을 하는 문자열도 일치시킬 필요가 생겼다.</p>
<p>하지만 세 환경에서는 모듈을 사용하는 방식이 서로 다르다. node.js에서는 모듈을 사용하기 위해 자체 모듈인 <code class="language-text">module</code>, <code class="language-text">require</code>를 사용하지만, 브라우저와 웹 워커에서는 사용할 수 없다. 브라우저에서는 Webpack과 ES6의 <code class="language-text">export</code>, <code class="language-text">import</code>를 사용한다. 그리고 웹 워커에서는 <code class="language-text">importScripts</code> 함수를 통해 외부 스크립트 내부에서 할당한 전역 객체를 사용해야 한다.</p>
<p>이 3가지 환경에서 모두 사용할 수 있는 모듈 선언 방식이 <a href="https://github.com/umdjs/umd">UMD (Universal Module Definition)</a> 패턴이다. 링크된 Github 저장소의 <code class="language-text">templates</code> 폴더에는 여러 사례에 대한 예제 코드가 작성되어 있다. 검색 엔진을 위한 모듈 작성에는 <a href="https://github.com/umdjs/umd/blob/master/templates/returnExports.js">returnExports.js</a> 예제를 활용했다.</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token comment">// searchUtil.js</span>
<span class="token comment">// 즉시 실행 함수(IIFE) 형태로 선언한다. factory는 모듈 객체를 반환하는 함수다.</span>
<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// webpack을 위한 AMD 모듈 선언 방식,</span>
  <span class="token comment">// webpack은 AMD, CommonJS 방식 둘 다 지원한다.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span>

  <span class="token comment">// node.js에 해당하는 케이스</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 모듈 객체를 전역 컨텍스트에 할당. 웹 워커와 브라우저에서 사용할 수 있다.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    root<span class="token punctuation">.</span>searchUtil <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 모듈 객체</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token constant">SEARCH_REQUEST</span><span class="token punctuation">:</span> <span class="token string">'SEARCH_REQUEST'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    trimText<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
      </div>
<p>이렇게 선언된 모듈은 각각의 환경에 맞는 방식으로 불러와서 사용할 수 있다.</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token comment">// node.js에서 사용</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> actions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../static/js/searchUtil'</span><span class="token punctuation">)</span></code></pre>
      </div>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token comment">// ES6 모듈에서 사용</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> actions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../static/js/searchUtil'</span></code></pre>
      </div>
<div class="gatsby-highlight">
      <pre class="language-js"><code class="language-js"><span class="token comment">// 웹 워커에서 사용</span>
<span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'./searchUtil.js'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>searchUtil<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token constant">SEARCH_REQUEST</span><span class="token punctuation">)</span></code></pre>
      </div>
<h2 id="향후-개선-방향"><a href="#%ED%96%A5%ED%9B%84-%EA%B0%9C%EC%84%A0-%EB%B0%A9%ED%96%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewbox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a>향후 개선 방향</h2>
<p>검색 기능을 구현하긴 했지만 말 그대로 동작할 정도로만 만들어 두었을 뿐이다. 검색어가 입력되면 단어 목록 전체를 살펴보기 때문에 현재 O(n)의 검색 시간이 걸리는 상태다. 이를 개선하기 위해서는 당장 생각하는 방법으로는 단어를 초성이나 글자별로 그룹화해서 일부만 찾아보는 방식이 있겠다. 검색 결과 캐싱, 랭킹 부여 방식도 개선 등 고칠 점이 많으니 천천히 시도해 볼 생각이다.</p></article><div class="sc-iRbamj ipnZXT" data-reactid="38"><button class="sc-jDwBTQ jmhhxf" data-reactid="39"><i class="fa fa-2x fa-facebook-square" data-reactid="40"></i></button><a class="sc-gPEVay iplCgW" href="https://twitter.com/intent/tweet?text=%EB%B8%94%EB%A1%9C%EA%B7%B8%20%EA%B2%80%EC%83%89%20%EA%B8%B0%EB%8A%A5%20%EA%B0%9C%EB%B0%9C%20%EA%B3%BC%EC%A0%95&amp;url=https%3A%2F%2Frhostem.github.io%2Fposts%2F2018-08-23-blog-search%2F" target="_blank" data-reactid="41"><i class="fa fa-2x fa-twitter" data-reactid="42"></i></a></div><div id="disqus_thread" data-reactid="43"></div></div><footer class="sc-jzJRlG gIzvqs" data-reactid="44"><div class="sc-cSHVUG hjGWNs" data-reactid="45"><div class="sc-kAzzGY gPyONe" data-reactid="46"><span data-reactid="47">Copyright © 2018. </span><a class="sc-chPdSV rzYpB" href="https://www.github.com/rhostem" data-reactid="48">rhostem</a><span data-reactid="49"> All rights reserved</span></div><div class="sc-kgoBCf fRgFwc" data-reactid="50"><a href="https://www.github.com/rhostem" data-reactid="51"><i class="fa fa-github" data-reactid="52"></i></a><a href="mailto:syoung.j@gmail.com" data-reactid="53"><i class="fa fa-envelope-o" data-reactid="54"></i></a><a href="/rss.xml" data-reactid="55"><i class="fa fa-rss" data-reactid="56"></i></a></div></div></footer></main></div></div></body></html>